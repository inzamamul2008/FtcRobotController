package org.firstinspires.ftc.teamcode;

import com.qualcomm.robotcore.eventloop.opmode.LinearOpMode;
import com.qualcomm.robotcore.eventloop.opmode.TeleOp;
import com.qualcomm.robotcore.hardware.DcMotor;

@TeleOp(name="TeleOp")
public class MecanumTeleOp extends LinearOpMode {
    @Override
    public void runOpMode() throws InterruptedException {

        DcMotor frontLeftMotor = hardwareMap.dcMotor.get("frontLeft");
        DcMotor backLeftMotor  = hardwareMap.dcMotor.get("backLeft");
        DcMotor frontRightMotor = hardwareMap.dcMotor.get("frontRight");
        DcMotor backRightMotor  = hardwareMap.dcMotor.get("backRight");
        DcMotor intakeMotor = hardwareMap.dcMotor.get("intake");
        DcMotor indexMotor  = hardwareMap.dcMotor.get("index");
        DcMotor lShooterMotor = hardwareMap.dcMotor.get("lShooter");
        DcMotor rShooterMotor = hardwareMap.dcMotor.get("rShooter");

        // Directions
        frontLeftMotor.setDirection(DcMotor.Direction.FORWARD);
        backLeftMotor.setDirection(DcMotor.Direction.FORWARD);
        frontRightMotor.setDirection(DcMotor.Direction.REVERSE);
        backRightMotor.setDirection(DcMotor.Direction.REVERSE);
        indexMotor.setDirection(DcMotor.Direction.REVERSE);
        rShooterMotor.setDirection(DcMotor.Direction.REVERSE);

        waitForStart();
        if (isStopRequested()) return;

        while (opModeIsActive()) {

            double y  = -gamepad1.left_stick_y;
            double x  = gamepad1.left_stick_x * 1.1;
            double rx = gamepad1.right_stick_x;

            double denominator = Math.max(Math.abs(y) + Math.abs(x) + Math.abs(rx), 1);

            double frontLeftPower  = (y + x + rx) / denominator;
            double backLeftPower   = (y - x + rx) / denominator;
            double frontRightPower = (y - x - rx) / denominator;
            double backRightPower  = (y + x - rx) / denominator;

            setSafePower(frontLeftMotor,  frontLeftPower);
            setSafePower(backLeftMotor,   backLeftPower);
            setSafePower(frontRightMotor, frontRightPower);
            setSafePower(backRightMotor,  backRightPower);

            // Intake
            setSafePower(intakeMotor, gamepad1.right_trigger);
            if (gamepad1.x) {
                setSafePower(indexMotor, 1.0);
           }
            else if (gamepad1.b) {
                setSafePower(indexMotor, -0.75);
            }
            else
            {
            setSafePower(indexMotor, 0);
            }

            if (gamepad1.a) {
                setSafePower(lShooterMotor, .75);
                setSafePower(rShooterMotor, .75);
            }
            else if (gamepad1.b) {
                setSafePower(lShooterMotor, -.75);
                setSafePower(rShooterMotor, -.75);
            }
            else {
                setSafePower(lShooterMotor, 0);
                setSafePower(rShooterMotor, 0);
            }

        }
    }

    void setSafePower(DcMotor motor, double targetPower) {
        final double SLEW_RATE = 0.2;
        double currentPower = motor.getPower();
        double desiredChange = targetPower - currentPower;
        double limitedChange = Math.max(-SLEW_RATE, Math.min(desiredChange, SLEW_RATE));
        motor.setPower(currentPower + limitedChange);
    }
}